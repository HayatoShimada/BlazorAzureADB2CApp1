@page "/classeslist"

@using Azure.Storage.Sas
@using BlazorAzureADB2CApp1.Models
@using Microsoft.EntityFrameworkCore
@using System.Text.RegularExpressions
@using Microsoft.AspNetCore.Components.Authorization
@using System.Security.Claims
@using FluentValidation
@using FluentValidation.Results
@using MudBlazor
@using Azure.Identity
@using Azure.Storage
@using Azure.Storage.Blobs
@using Azure.Storage.Blobs.Models
@using Azure.Storage.Blobs.Specialized

@inject NavigationManager Navigation
@inject ISnackbar Snackbar
@inject TestContext DbContext
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject UserStateService UserStateService
@inject IConfiguration Configuration
@inject BlobStorageService BlobService

@if (classes == null)
{
    <p>読み込み中</p>
}
else
{
    <MudTable Items="@classes"
              Hover="true"
              Breakpoint="Breakpoint.Sm"
              Loading="@_loading"
              LoadingProgressColor="Color.Info">

        <HeaderContent>
            <MudTh>ID</MudTh>
            <MudTh>名前</MudTh>
            <MudTh></MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="ParentId">@context.ClassId</MudTd>
            <MudTd DataLabel="Name">@context.Name</MudTd>
            <MudTd>
            </MudTd>
        </RowTemplate>

    </MudTable>
}

@code {

    private List<Models.Classes>? classes;
    private bool _loading = false;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            _loading = true;
            classes = await DbContext.Classes.ToListAsync();
        }
        catch (Exception ex)
        {
            Snackbar.Add($"データの読み込み中にエラーが発生しました: {ex.Message}", MudBlazor.Severity.Error);
        }
        finally
        {
            _loading = false;
        }
    }
}
